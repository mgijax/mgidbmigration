Mon Nov 22 09:01:28 EST 1999
Schema TR 204 Strains...
Password: 
Msg 2714, Level 16, State 1:
Procedure 'bit_default', Line 1:
There is already an object named 'bit_default' in the database.
Msg 2714, Level 16, State 1:
Procedure 'current_date_default', Line 2:
There is already an object named 'current_date_default' in the database.
New primary key added.
(return status = 0) 
Default bound to column.
(return status = 0) 
Default bound to column.
(return status = 0) 
New primary key added.
(return status = 0) 
Default bound to column.
(return status = 0) 
Default bound to column.
(return status = 0) 
New primary key added.
(return status = 0) 
Default bound to column.
(return status = 0) 
Default bound to column.
(return status = 0) 
New primary key added.
(return status = 0) 
Default bound to column.
(return status = 0) 
Default bound to column.
(return status = 0) 
New primary key added.
(return status = 0) 
Default bound to column.
(return status = 0) 
Default bound to column.
(return status = 0) 
New foreign key added.
(return status = 0) 
Msg 17561, Level 16, State 1:
Procedure 'sp_foreignkey', Line 136:
Primary key table doesn't exist.
(return status = 1) 
New foreign key added.
(return status = 0) 
New foreign key added.
(return status = 0) 
New foreign key added.
(return status = 0) 
Password: 
1> 
2> use strains
1> 
2> checkpoint
1> 
2> grant all on MLP_Species to mlp, progs
1> 
2> grant select on MLP_Species to mgd_public
1> 
2> grant all on MLP_Strain to mlp, progs
1> 
2> grant select on MLP_Strain to mgd_public
1> 
2> grant all on MLP_StrainType to mlp, progs
1> 
2> grant select on MLP_StrainType to mgd_public
1> 
2> grant select on MLP_StrainTypes to mgd_public
1> 
2> grant all on MLP_StrainTypes to mlp, progs
1> 
2> grant all on MLP_Notes to mlp, progs
1> 
2> grant select on MLP_Notes to mgd_public
1> 
2> checkpoint
SLMS...
Reading records from spreadsheet 'master.mgi.in' ...
Loading records from table 'PRB_Strain' ...
Processing ...
TR 204 CV load...
No Strain Type:  ['14568', '(B6CARB.I x SPE)F1']
No Species:  ['14568', '(B6CARB.I x SPE)F1']
No Species:  ['16790', '(NS.Hx<2n> x C4W)F1', '', 'Not Specified']
No Strain Type:  ['9042', 'C57BL/10-H2<sm1>', 'H2']
No Species:  ['9042', 'C57BL/10-H2<sm1>', 'H2']
No Strain Type:  ['25370', 'PM/Se']
No Species:  ['25370', 'PM/Se']
No Strain Type:  ['719', 'Stock T/t<wPa1>', 'T, t']
No Species:  ['719', 'Stock T/t<wPa1>', 'T, t']
TR 204 Strain load...
Invalid Symbol: In(10)17Rk
Invalid Symbol: Ts(11;16)53Dn
Invalid Symbol: Ts(17;16)65Dn
Invalid Symbol: Rb(5.8)3Dn
Invalid Symbol: In(1)12Rk
Invalid Symbol: In(1)1Rk
Invalid Symbol: In(7)13Rk
Invalid Symbol: Rb(3.15)10Mpl
Invalid Symbol: In(10)17Rk
Invalid Symbol: Gpi
Invalid Symbol: In(1)12Rk
Invalid Symbol: In(1)1Rk
Invalid Symbol: In(1)24Rk
Invalid Symbol: In(10)6Rk
Invalid Symbol: In(12)25Rk
Invalid Symbol: In(13)31Rk
Invalid Symbol: In(14)22Rk
Invalid Symbol: In(15)18Rk
Invalid Symbol: In(15)21Rk
Invalid Symbol: In(16)37Rk
Invalid Symbol: In(2)19Rk
Invalid Symbol: In(2)3Dn
Invalid Symbol: In(2)5Rk
Invalid Symbol: In(3)11Rk
Invalid Symbol: In(4)1Dn
Invalid Symbol: In(4)28Rk
Invalid Symbol: In(4)32Rk
Invalid Symbol: In(4)55Rk
Invalid Symbol: In(5)2Rk
Invalid Symbol: In(5)30Rk
Invalid Symbol: In(5)33Rk
Invalid Symbol: In(5)9Rk
Invalid Symbol: In(7)13Rk
Invalid Symbol: In(8)14Rk
Invalid Symbol: In(9)26Rk
Invalid Symbol: In(10)17Rk
Invalid Symbol: In(3)55Rk
TR 204 Notes load...
Invalid or Duplicate Strain:  M. dom-Pgn 1 
Invalid or Duplicate Strain:  M. sub-Ias 3
Invalid or Duplicate Strain:  M. sub-Jyg
Invalid or Duplicate Strain:  (AKR/J NFS/N or C58/J x SKIVE)
Invalid or Duplicate Strain:  (B10.MOL-SGR x B10.D2)F1 (d2mR1)
Invalid or Duplicate Strain:  (B10.MOL-SGR x B10.D2)F1 (d2mR2)
Invalid or Duplicate Strain:  (BALB/cAnPt-Rb(4.12) x C.B-20)F1
Invalid or Duplicate Strain:  (C3Hf/Rl-Mgf<Sl-2ENURg>/+ x M. spretus)F1
Invalid or Duplicate Strain:  (C3Hf/Rl-Mgf<Sl-ENURg>/+ x M. spretus)F1
Invalid or Duplicate Strain:  (C57BL/6.KB2-mnd/Msr x AKR/J or C3H/HeJ)F1
Invalid or Duplicate Strain:  (C57BL/6J-spretus pe<+Pin>/pe<+Pin> x C57BL/6JPin-pe/pe)F1
Invalid or Duplicate Strain:  (Mor2<am1H> x PCE)F1
Invalid or Duplicate Strain:  (NMRI/F x kl/oci)F1
Invalid or Duplicate Strain:  101/OR (101/Orr)
Invalid or Duplicate Strain:  129/Sv and CD1   
Invalid or Duplicate Strain:  129/SvEv-Il1r2b<tm1Jm>
Invalid or Duplicate Strain:  129/SvEv-Il1r2b<tm1Jm>
Invalid or Duplicate Strain:  129/SvEv-Il1rb<tm1Jm>
Invalid or Duplicate Strain:  Af3 (3FR60Hc)
Invalid or Duplicate Strain:  (C57BL/K1 x DBA/2K1)F1
Invalid or Duplicate Strain:  Axin<kb>/+ and C57BL/6
Invalid or Duplicate Strain:  B10.L1B18
Invalid or Duplicate Strain:  B10.SM-H2<v>H2-T18<b> (70NS)/Sn cw
Invalid or Duplicate Strain:  B6 x B6C3H-a/A-T17H/+
Invalid or Duplicate Strain:  B6 x B6C3H-a/A-T27H
Invalid or Duplicate Strain:  B6 x B6C3H-a/A-T31H/+
Invalid or Duplicate Strain:  B6 x B6CBA/Ca-A<w-J>/A-T264Ca Kit<W-v>
Invalid or Duplicate Strain:  B6 x B6CBACa-A<w-J>/A-Grid2<Lc> T7Ca Mitf<Mi-wh>
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T164Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T198Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T202Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T225Dn
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T232Dn
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T233Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T238Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T41Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T45Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T57Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T60Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T65Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T69Dn/+
Invalid or Duplicate Strain:  B6 x B6EiC3H-a/A-T97Dn/+
Invalid or Duplicate Strain:  B6 x C.AKR-cog/+
Invalid or Duplicate Strain:  B6 x STOCK a p ru2 Ednrb<s> 
Invalid or Duplicate Strain:  B6 x STOCK het 
Invalid or Duplicate Strain:  B6 x STOCK In58Rk 
Invalid or Duplicate Strain:  B6 x STOCK Rb(6.15)1Ald 
Invalid or Duplicate Strain:  B6 x STOCK T(12:17)4Rk/+
Invalid or Duplicate Strain:  B6 x STOCK T11H
Invalid or Duplicate Strain:  B6 x STOCK T13H a/T13H a 
Invalid or Duplicate Strain:  B6 x STOCK T18H
Invalid or Duplicate Strain:  B6 x STOCK T1Ca 
Invalid or Duplicate Strain:  B6 x STOCK T24H
Invalid or Duplicate Strain:  B6 x STOCK T26H 
Invalid or Duplicate Strain:  B6 x STOCK T28H/+
Invalid or Duplicate Strain:  B6 x STOCK T50H/+ a/a
Invalid or Duplicate Strain:  B6 x STOCK Tyr<c-ch> Bmp5<se> +/+ Myo6<sv> 
Invalid or Duplicate Strain:  (C57BL/6J x B6(CAST-H19))F1
Invalid or Duplicate Strain:  (B6(CAST-H19 x C57BL/6J))F1
Invalid or Duplicate Strain:  B6(CAST-H19)  
Invalid or Duplicate Strain:  B6.C-H30<c> /By (HW105)
Invalid or Duplicate Strain:  B6.M. spretus-pe<+PIN>N12F6
Invalid or Duplicate Strain:  B6C3Fe-a/a F1
Invalid or Duplicate Strain:  B6EiC3H-a/A F1
Invalid or Duplicate Strain:  BALB/cBy(E228)
Invalid or Duplicate Strain:  BALB/cBy-H(E2) 
Invalid or Duplicate Strain:  BALB/cBy-H(E3) 
Invalid or Duplicate Strain:  BALB/cBy-H(E4) 
Invalid or Duplicate Strain:  BALB/cBy-H(E6) 
Invalid or Duplicate Strain:  BALB/cBy-H(F5) 
Invalid or Duplicate Strain:  BALB/cJ or C57BL/6-Kcnj6<wv>/Kcnj6<wv>
Invalid or Duplicate Strain:  C57BL/6-Il12rb<tm1Jm>
Invalid or Duplicate Strain:  C57BL/6J pe<+Pin>/pe<+Pin>
Invalid or Duplicate Strain:  C57BL/6J x STOCK In17Rk
Invalid or Duplicate Strain:  C57BL/6J-D1Lub1Hsr/+
Invalid or Duplicate Strain:  C57BL/6J-Pmp22<Tr-J> and SPRET/Ei -pe<+Pin>
Invalid or Duplicate Strain:  C57BL/6J-Psp<b> a; d = Psp<b> a<t>
Invalid or Duplicate Strain:  C57BL/6J-Psp<b> A<w>; d = Psp<b> a
Invalid or Duplicate Strain:  CAS-QZN-Mt2<a>
Invalid or Duplicate Strain:  CASA/Rk and (B6C3F-a/a-Hoxa13<Hd> Va<J> x CASA/Rk)F1
Invalid or Duplicate Strain:  cHS/cHS
Invalid or Duplicate Strain:  FVB/N and 129/SvJae
Invalid or Duplicate Strain:  Inbred
Invalid or Duplicate Strain:  M. cas-Bgr 1  
Invalid or Duplicate Strain:  M. dom-Pgn 
Invalid or Duplicate Strain:  M. m. macedonicus, M. m. musculus
Invalid or Duplicate Strain:  M. mol-Kgs
Invalid or Duplicate Strain:  M. sub-Cht
Invalid or Duplicate Strain:  MEV, BXD-32 or SWR/J
Invalid or Duplicate Strain:  MEV/Ty, BXD-32/J, SWR/J
Invalid or Duplicate Strain:  MINI IGF-1
Invalid or Duplicate Strain:  MOL-ANJ
Invalid or Duplicate Strain:  MOL-TEN2
Invalid or Duplicate Strain:  Mor2<am4Neu
Invalid or Duplicate Strain:  Mut/Mut  
Invalid or Duplicate Strain:  Mut<del>/Mut<del>
Invalid or Duplicate Strain:  NOD/Mrk, (B10.H2<g7> x NOD/Mrk)F1 and NOD/Mrk
Invalid or Duplicate Strain:  NZW/LacJ x BXSB/MpJ
Invalid or Duplicate Strain:  Parkes
Invalid or Duplicate Strain:  Rb(6.15)1Ald or Rb163H/Ei
Invalid or Duplicate Strain:  Rb(6.16)24Lub-Cacna1a<tg-3J>
Invalid or Duplicate Strain:  Reeves' sex-averaged intersubspecific mapping panel
Invalid or Duplicate Strain:  SEW
Invalid or Duplicate Strain:  SEW1
Invalid or Duplicate Strain:  NKT/Pas   
Invalid or Duplicate Strain:  MolSkiR
Invalid or Duplicate Strain:  ROSA41
Invalid or Duplicate Strain:  GL/Le-dl<J> +/+ gl or C57BL/6J    
Invalid or Duplicate Strain:  AK-Fr-1b
Invalid or Duplicate Strain:  (C57BL/6 x S3L/3)F1   
Invalid or Duplicate Strain:  CITB-CJ7-B 
Invalid or Duplicate Strain:  C57BL/6-129/Sv-wn/wn    
Invalid or Duplicate Strain:  (C57BL/6-129/Sv-wn/wn x C3H/HeJ)F1 
Invalid or Duplicate Strain:  C57BL/6-129/Sv 
Invalid or Duplicate Strain:  C57BL/6 or BALB/c and 129X1/SvJ 
Invalid or Duplicate Strain:  C57BL/6 and 129/SvEv  
Invalid or Duplicate Strain:  C57BL/6 and 129   
Invalid or Duplicate Strain:  (Parkes x NIH)F1 x NIH   
Invalid or Duplicate Strain:  Parkes
Invalid or Duplicate Strain:  Parkes
Invalid or Duplicate Strain:  Sprague Dawley     
Invalid or Duplicate Strain:  C57BL/KSJ
Invalid or Duplicate Strain:  STOCK Is1Ct
Invalid or Duplicate Strain:  STOCK T30H/+ x AEJ-a Gdf5<bp-H> or A/J-a Gdf5<bp-J>
Invalid or Duplicate Strain:  SUB-BJN
Invalid or Duplicate Strain:  SUB-KJR
Invalid or Duplicate Strain:  SUB-LAS
Invalid or Duplicate Strain:  Swiss
Invalid or Duplicate Strain:  T/t<csh201>
Invalid or Duplicate Strain:  T/t<csh202>
Invalid or Duplicate Strain:  T<wis>/+
Invalid or Duplicate Strain:  tg(13HBV)E36-Pas
Invalid or Duplicate Strain:  Tg6208
Invalid or Duplicate Strain:  Tg74/Tg74 and Tg74/+ transgenics
Invalid or Duplicate Strain:  TUC CF1
Invalid or Duplicate Strain:  tw2
Invalid or Duplicate Strain:  wild type
Invalid or Duplicate Strain:  wild type
Invalid or Duplicate Strain:  WL76
Strain triggers/procedures/views...
Password: 
1> 
2> use strains
1> 
2> checkpoint
1> 
2> drop view MLP_Strain_View
1> 
2> create view MLP_Strain_View
3> as
4> select s.*, sp.species, p.strain, p.standard, p.needsReview
5> from MLP_Strain s, MLP_Species sp, mgd..PRB_Strain p
6> where s._Species_key = sp._Species_key
7> and s._Strain_key = p._Strain_key
1> 
2> grant select on MLP_Strain_View to public
1> 
2> drop view MLP_StrainTypes_View
1> 
2> create view MLP_StrainTypes_View
3> as
4> select s.*, st.strainType
5> from MLP_StrainTypes s, MLP_StrainType st
6> where s._StrainType_key = st._StrainType_key
1> 
2> grant select on MLP_StrainTypes_View to public
1> 
2> checkpoint
Password: 
1> 
2> use strains
1> 
2> checkpoint
1> 
2> drop procedure GEN_rowcount
1>  
2> create procedure GEN_rowcount
3>   @table varchar(30)
4> as
5> 
6> select convert(char(10),rowcnt(MAX(doampg)))
7> from sysobjects o, sysindexes i
8> where o.name = @table
9> and o.id = i.id
1> 
2> grant execute on GEN_rowcount to public
1> 
2> checkpoint
Password: 
1> 
2> use strains
1> 
2> checkpoint
1> 
2> drop procedure MLP_mergeStrain
1>  
2> create procedure MLP_mergeStrain
3>   @oldStrainKey int,
4>   @newStrainKey int
5> as
6> 
7> /*
8>  * Update old Strain key to new Strain key
9>  * in all relevant tables which contain a Strain key.
10>  * When finished, remove the Strain record for the old
11>  * Strain key.
12> */
13> 
14> if (select count(*) from mgd..PRB_Allele_Strain where _Strain_key in (@oldStrainKey, @newStrainkey)
15>     group by _Allele_key having count(*) > 1) > 0
16> begin
17> 	declare @alleleKey integer
18> 	declare @probe varchar(255)
19> 	declare @jnum varchar(100)
20> 
21> 	declare allele_cursor cursor for
22> 	select distinct _Allele_key
23> 	from mgd..PRB_Allele_Strain
24> 	where _Strain_key in (@oldStrainKey, @newStrainkey)
25>         group by _Allele_key having count(*) > 1
26> 	for read only
27>  
28> 	open allele_cursor
29>  
30> 	fetch allele_cursor into @alleleKey
31>  
32> 	while (@@sqlstatus = 0)
33> 	begin
34> 		select @probe = p.name, @jnum = b.accID
35> 		from mgd..PRB_Allele a, mgd..PRB_RFLV v, mgd..PRB_Reference  r, mgd..PRB_Probe p, mgd..BIB_Acc_View b
36> 		where a._Allele_key = @alleleKey and
37> 		      a._RFLV_key = v._RFLV_key and
38> 		      v._Reference_key = r._Reference_key and
39> 		      r._Probe_key = p._Probe_key and
40> 		      r._Refs_key = b._Object_key and
41> 		      b.prefixPart = 'J:'
42> 
43> 		rollback transaction
44> 		raiserror 99999 "This merge would create a duplicate entry for Probe '%1!', %2!", @probe, @jnum
45> 		return
46> 	end
47>  
48> 	close allele_cursor
49>  
50> 	deallocate cursor allele_cursor
51> 
52> end
53> 
54> /* all Strains must have same symbols */
55> 
56> if exists (select m1.* from mgd..PRB_Strain_Marker m1
57>            where m1._Strain_key = @newStrainKey
58> 	   and not exists
59> 	   (select m2.* from mgd..PRB_Strain_Marker m2
60> 	    where m2._Strain_key = @oldStrainKey and
61> 	    m2._Marker_key = m1._Marker_key))
62> begin
63> 	rollback transaction
64> 	raiserror 99999 "Old and New Strains must have the same Marker Symbols"
65> 	return
66> end
67> 
68> if exists (select m1.* from mgd..PRB_Strain_Marker m1
69>            where m1._Strain_key = @oldStrainKey
70> 	   and not exists
71> 	   (select m2.* from mgd..PRB_Strain_Marker m2
72> 	    where m2._Strain_key = @newStrainKey and
73> 	    m2._Marker_key = m1._Marker_key))
74> begin
75> 	rollback transaction
76> 	raiserror 99999 "Old and New Strains must have the same Marker Symbols"
77> 	return
78> end
79> 
80> /* both Strains must have the same Strain Types */
81> 
82> if exists (select m1.* from MLP_StrainTypes m1
83>            where m1._Strain_key = @newStrainKey
84> 	   and not exists
85> 	   (select m2.* from MLP_StrainTypes m2
86> 	    where m2._Strain_key = @oldStrainKey and
87> 	    m2._StrainType_key = m1._StrainType_key))
88> begin
89> 	rollback transaction
90> 	raiserror 99999 "Old and New Strains must have the same Strain Types"
91> 	return
92> end
93> 
94> if exists (select m1.* from MLP_StrainTypes m1
95>            where m1._Strain_key = @oldStrainKey
96> 	   and not exists
97> 	   (select m2.* from MLP_StrainTypes m2
98> 	    where m2._Strain_key = @newStrainKey and
99> 	    m2._StrainType_key = m1._StrainType_key))
100> begin
101> 	rollback transaction
102> 	raiserror 99999 "Old and New Strains must have the same Strain Types"
103> 	return
104> end
105> 
106> /* both Strains must have the same Species value */
107> 
108> if (select _Species_key from MLP_Strain where _Strain_key = @newStrainKey) !=
109>    (select _Species_key from MLP_Strain where _Strain_key = @oldStrainKey)
110> begin
111> 	rollback transaction
112> 	raiserror 99999 "Old and New Strains must have the same Species"
113> 	return
114> end
115> 
116> /* both Strains must have the same Needs Review value */
117> 
118> if (select needsReview from mgd..PRB_Strain where _Strain_key = @newStrainKey) !=
119>    (select needsReview from mgd..PRB_Strain where _Strain_key = @oldStrainKey)
120> begin
121> 	rollback transaction
122> 	raiserror 99999 "Old and New Strains must have the same Needs Review value"
123> 	return
124> end
125> 
126> /* JAX Registry - must be equal OR use the one that exists */
127> 
128> declare @jaxRegistryNew varchar(30)
129> declare @jaxRegistryOld varchar(30)
130> 
131> select @jaxRegistryNew = NULL
132> select @jaxRegistryOld = NULL
133> 
134> if exists (select accID from mgd..ACC_Accession
135>            where _Object_key = @newStrainKey and _LogicalDB_Key = 22 and _MGIType_key = 10)
136> begin
137> 	select @jaxRegistryNew = accID from mgd..ACC_Accession
138> 	where _Object_key = @newStrainKey and _LogicalDB_Key = 22 and _MGIType_key = 10
139> end
140> 
141> if exists (select _Accession_key from mgd..ACC_Accession
142>            where _Object_key = @oldStrainKey and _LogicalDB_Key = 22 and _MGIType_key = 10)
143> begin
144> 	select @jaxRegistryOld = accID from mgd..ACC_Accession
145> 	where _Object_key = @oldStrainKey and _LogicalDB_Key = 22 and _MGIType_key = 10
146> end
147> 
148> if (@jaxRegistryNew != NULL and @jaxRegistryOld != NULL and
149>     @jaxRegistryNew != @jaxRegistryOld)
150> begin
151> 	rollback transaction
152> 	raiserror 99999 "Old and New Strains must have the same JAX Registry Number"
153> 	return
154> end
155> else if (@jaxRegistryOld != NULL)
156> begin
157>     select @jaxRegistryNew = @jaxRegistryOld
158> end
159> 
160> update mgd..ACC_Accession
161> set _Object_key = @newStrainKey
162> where accID = @jaxRegistryNew
163> and _LogicalDB_Key = 22
164> and _MGIType_key = 10
165> 
166> update mgd..PRB_Source
167> set _Strain_key = @newStrainKey
168> where _Strain_key = @oldStrainKey
169> 
170> update mgd..PRB_Allele_Strain
171> set _Strain_key = @newStrainKey
172> where _Strain_key = @oldStrainKey
173> 
174> update mgd..MLD_FISH
175> set _Strain_key = @newStrainKey
176> where _Strain_key = @oldStrainKey
177> 
178> update mgd..MLD_InSitu
179> set _Strain_key = @newStrainKey
180> where _Strain_key = @oldStrainKey
181> 
182> update mgd..CRS_Cross
183> set _femaleStrain_key = @newStrainKey
184> where _femaleStrain_key = @oldStrainKey
185> 
186> update mgd..CRS_Cross
187> set _maleStrain_key = @newStrainKey
188> where _maleStrain_key = @oldStrainKey
189> 
190> update mgd..CRS_Cross
191> set _StrainHO_key = @newStrainKey
192> where _StrainHO_key = @oldStrainKey
193> 
194> update mgd..CRS_Cross
195> set _StrainHT_key = @newStrainKey
196> where _StrainHT_key = @oldStrainKey
197> 
198> update mgd..GXD_Genotype
199> set _Strain_key = @newStrainKey
200> where _Strain_key = @oldStrainKey
201> 
202> update mgd..PRB_Strain_Marker
203> set _Strain_key = @newStrainKey
204> where _Strain_key = @oldStrainKey
205> 
206> update MLP_StrainTypes
207> set _Strain_key = @newStrainKey
208> where _Strain_key = @oldStrainKey
209> 
210> /* Delete trigger will delete records from PRB_Strain */
211> 
212> delete from MLP_Strain
213> where _Strain_key = @oldStrainKey
214> 
1> 
2> grant execute on MLP_mergeStrain to editors
1>  
2> grant execute on MLP_mergeStrain to progs
1>  
2> drop procedure MLP_mergeStandardStrain
1>  
2> create procedure MLP_mergeStandardStrain
3>   @strain varchar(255),
4>   @fromStandard int = 0,
5>   @toStandard int = 1
6> as
7>  
8> /* Given a Strain, merge all of the records into one Strain.
9>  *
10>  * Merge all Non-Standard Strains into the Standard Strain (default)
11>  * (exec PRB_mergeStandardStrain "Strain")
12>  *
13>  * OR
14>  *
15>  * Merge all Standard Strains into the Non-Standard Strain
16>  * (exec PRB_mergeStandardStrain "Strain", 1, 0)
17>  *
18> */
19> 
20> declare @newStrainKey integer
21> declare @oldStrainKey integer
22> 
23> if (select count(_Strain_key) from mgd..PRB_Strain
24>     where strain = @strain and standard = @toStandard) > 1
25> begin
26> 	rollback transaction
27> 	raiserror 99999 "More than one designation exists for Strain: %1!", @strain
28> 	return
29> end
30> 
31> if (select count(_Strain_key) from mgd..PRB_Strain
32>     where strain = @strain and standard = @toStandard) = 0
33> begin
34> 	rollback transaction
35> 	raiserror 99999 "No correct designation exists for Strain: %1!", @strain
36> 	return
37> end
38> 
39> select @newStrainKey = _Strain_key from mgd..PRB_Strain
40> where strain = @strain and standard = @toStandard
41> 
42> declare strain_cursor cursor for
43> select _Strain_key
44> from mgd..PRB_Strain
45> where strain = @strain and standard = @fromStandard
46> for read only
47>  
48> open strain_cursor
49>  
50> fetch strain_cursor into @oldStrainKey
51>  
52> while (@@sqlstatus = 0)
53> begin
54> 	exec MLP_mergeStrain @oldStrainKey, @newStrainKey
55>         fetch strain_cursor into @oldStrainKey
56> end
57>  
58> close strain_cursor
59>  
60> deallocate cursor strain_cursor
61>  
1> 
2> grant execute on MLP_mergeStandardStrain to editors
1>  
2> grant execute on MLP_mergeStandardStrain to progs
1>  
2> checkpoint
Password: 
1> 
2> use strains
1> 
2> checkpoint
1> 
2> drop trigger MLP_Strain_Delete
Msg 3701, Level 11, State 1:
Line 2:
Cannot drop the trigger 'MLP_Strain_Delete', because it doesn't exist in the
system catalogs.
1> 
2> create trigger MLP_Strain_Delete
3> on MLP_Strain
4> for delete
5> as
6> 
7> delete mgd..PRB_Strain from mgd..PRB_Strain, deleted
8> where mgd..PRB_Strain._Strain_key = deleted._Strain_key
9> 
10> delete MLP_Notes from MLP_Notes, deleted
11> where MLP_Notes._Strain_key = deleted._Strain_key
12> 
13> delete MLP_StrainTypes from MLP_StrainTypes, deleted
14> where MLP_StrainTypes._Strain_key = deleted._Strain_key
15> 
16> delete mgd..ACC_Accession 
17> from mgd..ACC_Accession a, mgd..ACC_MGIType m, deleted
18> where a._Object_key = deleted._Strain_key
19> and a._MGIType_key = m._MGIType_key
20> and m.name = "Strain"
21> 
1> 
2> drop trigger MLP_StrainType_Delete
Msg 3701, Level 11, State 1:
Line 2:
Cannot drop the trigger 'MLP_StrainType_Delete', because it doesn't exist in the
system catalogs.
1> 
2> create trigger MLP_StrainType_Delete
3> on MLP_StrainType
4> for delete
5> as
6> 
7> /* Disallow deletion if Strain Type is referenced elsewhere */
8> 
9> if exists (select * from MLP_StrainTypes, deleted
10>          where MLP_StrainTypes._StrainType_key = deleted._StrainType_key)
11> begin
12>         rollback transaction
13>         raiserror 99999 "Strain Type is referenced in Strain Record(s)"
14> 	return
15> end
16>  
1> 
2> drop trigger MLP_Species_Delete
Msg 3701, Level 11, State 1:
Line 2:
Cannot drop the trigger 'MLP_Species_Delete', because it doesn't exist in the
system catalogs.
1> 
2> create trigger MLP_Species_Delete
3> on MLP_Species
4> for delete
5> as
6> 
7> /* Disallow deletion if Species is referenced elsewhere */
8> 
9> if exists (select * from MLP_Strain, deleted
10>          where MLP_Strain._Species_key = deleted._Species_key)
11> begin
12>         rollback transaction
13>         raiserror 99999 "Species is referenced in Strain Record(s)"
14> 	return
15> end
16>  
1> 
2> checkpoint
Mon Nov 22 09:10:56 EST 1999
